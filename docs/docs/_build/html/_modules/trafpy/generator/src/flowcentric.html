

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>trafpy.generator.src.flowcentric &mdash; TrafPy 0.0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> TrafPy
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../Install.html">Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../Tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../Contribute.html">Contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../License.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../Citing.html">Citing</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">TrafPy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
      <li>trafpy.generator.src.flowcentric</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for trafpy.generator.src.flowcentric</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">trafpy.generator.src.dists</span> <span class="kn">import</span> <span class="n">val_dists</span><span class="p">,</span> <span class="n">node_dists</span>
<span class="kn">from</span> <span class="nn">trafpy.generator.src</span> <span class="kn">import</span> <span class="n">tools</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">random</span>


<div class="viewcode-block" id="create_flow_centric_demand_data"><a class="viewcode-back" href="../../../../trafpy.generator.src.html#trafpy.generator.src.flowcentric.create_flow_centric_demand_data">[docs]</a><span class="k">def</span> <span class="nf">create_flow_centric_demand_data</span><span class="p">(</span><span class="n">num_demands</span><span class="p">,</span>
                                    <span class="n">eps</span><span class="p">,</span>
                                    <span class="n">node_dist</span><span class="p">,</span> 
                                    <span class="n">flow_size_dist</span><span class="p">,</span>
                                    <span class="n">interarrival_time_dist</span><span class="p">,</span>
                                    <span class="n">duration_time_dist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                    <span class="n">print_data</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">print_data</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Generating </span><span class="si">{}</span><span class="s1"> flow demands...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_demands</span><span class="p">))</span>
    <span class="n">started</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="c1"># initialise</span>
    <span class="n">f_ids</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;flow_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_demands</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">duration_time_dist</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># duplicate</span>
        <span class="n">f_ids2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;flow_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_demands</span><span class="p">)]</span>
        <span class="n">flow_ids</span> <span class="o">=</span> <span class="n">f_ids</span> <span class="o">+</span> <span class="n">f_ids2</span> <span class="c1"># duplicate</span>
        <span class="n">establish</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">flow_ids</span><span class="p">)))),</span> 
                                    <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">flow_ids</span><span class="p">))))))</span> 
    <span class="k">else</span><span class="p">:</span>
        <span class="n">flow_ids</span> <span class="o">=</span> <span class="n">f_ids</span>
        <span class="n">establish</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">flow_ids</span><span class="p">)))),</span> 
                                    <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">flow_ids</span><span class="p">))))))</span> 

    <span class="n">flow_sizes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">flow_ids</span><span class="p">))))</span>
    
    <span class="k">if</span> <span class="n">duration_time_dist</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">duplicate</span><span class="o">=</span><span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">duplicate</span><span class="o">=</span><span class="kc">False</span>
    <span class="n">sn</span><span class="p">,</span> <span class="n">dn</span> <span class="o">=</span> <span class="n">node_dists</span><span class="o">.</span><span class="n">gen_node_demands</span><span class="p">(</span><span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span>
                                         <span class="n">node_dist</span><span class="o">=</span><span class="n">node_dist</span><span class="p">,</span> 
                                         <span class="n">num_demands</span><span class="o">=</span><span class="n">num_demands</span><span class="p">,</span> 
                                         <span class="n">duplicate</span><span class="o">=</span><span class="n">duplicate</span><span class="p">)</span>

    <span class="c1"># create demand flow_sizes</span>
    <span class="n">flow_sizes</span><span class="p">[:</span><span class="n">num_demands</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_dists</span><span class="o">.</span><span class="n">gen_val_dist_data</span><span class="p">(</span><span class="n">val_dist</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">flow_size_dist</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> 
                                                           <span class="n">num_vals_to_gen</span><span class="o">=</span><span class="n">num_demands</span><span class="p">,</span> 
                                                           <span class="n">min_val</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">flow_size_dist</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> 
                                                           <span class="n">max_val</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">flow_size_dist</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="k">if</span> <span class="n">duration_time_dist</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">flow_sizes</span><span class="p">[</span><span class="n">num_demands</span><span class="p">:]</span> <span class="o">=</span> <span class="n">flow_sizes</span><span class="p">[:</span><span class="n">num_demands</span><span class="p">]</span>
    
    <span class="c1"># create event time array</span>
    <span class="n">interarrival_times</span> <span class="o">=</span> <span class="n">val_dists</span><span class="o">.</span><span class="n">gen_rand_vars_from_discretised_dist</span><span class="p">(</span><span class="n">unique_vars</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">interarrival_time_dist</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
                                                                       <span class="n">probabilities</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">interarrival_time_dist</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span>
                                                                       <span class="n">num_demands</span><span class="o">=</span><span class="n">num_demands</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">duration_time_dist</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">interarrival_times</span> <span class="o">=</span> <span class="n">val_dists</span><span class="o">.</span><span class="n">gen_rand_vars_from_discretised_dist</span><span class="p">(</span><span class="n">unique_vars</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">interarrival_time_dist</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
                                                                           <span class="n">probabilities</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">interarrival_time_dist</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span>
                                                                           <span class="n">num_demands</span><span class="o">=</span><span class="n">num_demands</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">duration_times</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">event_times</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">gen_event_times</span><span class="p">(</span><span class="n">interarrival_times</span><span class="p">,</span> <span class="n">duration_times</span><span class="p">)</span>
    <span class="n">index</span><span class="p">,</span> <span class="n">event_times_sorted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">event_times</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">event_times</span><span class="p">)</span>

    <span class="c1"># compile data into demand data dict</span>
    <span class="n">demand_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;flow_id&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">flow_ids</span><span class="p">)[</span><span class="n">index</span><span class="p">],</span>
                   <span class="s1">&#39;sn&#39;</span><span class="p">:</span> <span class="n">sn</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
                   <span class="s1">&#39;dn&#39;</span><span class="p">:</span> <span class="n">dn</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
                   <span class="s1">&#39;flow_size&#39;</span><span class="p">:</span> <span class="n">flow_sizes</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
                   <span class="s1">&#39;event_time&#39;</span><span class="p">:</span> <span class="n">event_times_sorted</span><span class="p">,</span>
                   <span class="s1">&#39;establish&#39;</span><span class="p">:</span> <span class="n">establish</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span>
                   <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="n">index</span><span class="p">}</span>
   
    <span class="n">ended</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">print_data</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Generated </span><span class="si">{}</span><span class="s1"> flow demands in </span><span class="si">{}</span><span class="s1"> seconds.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_demands</span><span class="p">,</span><span class="n">ended</span><span class="o">-</span><span class="n">started</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">demand_data</span></div>


<div class="viewcode-block" id="set_flow_centric_demand_data_network_load"><a class="viewcode-back" href="../../../../trafpy.generator.src.html#trafpy.generator.src.flowcentric.set_flow_centric_demand_data_network_load">[docs]</a><span class="k">def</span> <span class="nf">set_flow_centric_demand_data_network_load</span><span class="p">(</span><span class="n">demand_data</span><span class="p">,</span> <span class="n">network_rate_capacity</span><span class="p">,</span> <span class="n">target_load_fraction</span><span class="p">,</span> <span class="n">print_data</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">demand_data</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">demand_data</span><span class="p">)</span>
    
    <span class="k">assert</span> <span class="n">target_load_fraction</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span> \
        <span class="s1">&#39;Must have target load fraction &lt;= 1 for compatability with network rate capacity.&#39;</span>
    
    <span class="n">target_load_rate</span> <span class="o">=</span> <span class="n">network_rate_capacity</span><span class="o">*</span><span class="n">target_load_fraction</span>
    <span class="n">load_rate</span> <span class="o">=</span> <span class="n">get_flow_centric_demand_data_load_rate</span><span class="p">(</span><span class="n">demand_data</span><span class="p">)</span>
    <span class="n">init_load_rate</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">load_rate</span><span class="p">)</span>
    <span class="n">init_load_fraction</span> <span class="o">=</span> <span class="n">init_load_rate</span> <span class="o">/</span> <span class="n">network_rate_capacity</span>
    
    <span class="n">change_in_num_demands</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">load_rate</span> <span class="o">&gt;</span> <span class="n">target_load_rate</span><span class="p">:</span>
        <span class="c1"># randomly drop demands until get target load rate</span>
        <span class="k">while</span> <span class="n">load_rate</span> <span class="o">&gt;</span> <span class="n">target_load_rate</span><span class="p">:</span>
            <span class="n">demand_data</span> <span class="o">=</span> <span class="n">drop_random_flow_from_demand_data</span><span class="p">(</span><span class="n">demand_data</span><span class="p">)</span>
            <span class="n">load_rate</span> <span class="o">=</span> <span class="n">get_flow_centric_demand_data_load_rate</span><span class="p">(</span><span class="n">demand_data</span><span class="p">)</span>
            <span class="n">change_in_num_demands</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="n">load_rate</span> <span class="o">&lt;</span> <span class="n">target_load_rate</span><span class="p">:</span>
        <span class="n">load_fraction</span> <span class="o">=</span> <span class="n">load_rate</span> <span class="o">/</span> <span class="n">network_rate_capacity</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Load is </span><span class="si">{}</span><span class="s1">, but requested target load is </span><span class="si">{}</span><span class="s1">. Either decrease target load or increase load in demand_data. To increase load in demand_data, increase number of demands generated or adjust e.g. event size, interarrival time, etc., then re-construct demand_data and pass back into this function.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">load_fraction</span><span class="p">,</span> <span class="n">target_load_fraction</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">pass</span>
    
    <span class="n">load_fraction</span> <span class="o">=</span> <span class="n">load_rate</span> <span class="o">/</span> <span class="n">network_rate_capacity</span>
    
    <span class="k">if</span> <span class="n">print_data</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Network rate capacity: </span><span class="si">{}</span><span class="s1"> Gbps&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">network_rate_capacity</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Initial load rate: </span><span class="si">{}</span><span class="s1"> Gbps&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">init_load_rate</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Initial load fraction: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">init_load_fraction</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Target load rate: </span><span class="si">{}</span><span class="s1"> Gbps&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">target_load_rate</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Target load fraction: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">target_load_fraction</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Final load rate: </span><span class="si">{}</span><span class="s1"> Gbps&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">load_rate</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Final load fraction: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">load_fraction</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Change in number of demands: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">change_in_num_demands</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Final number of demands: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">demand_data</span><span class="p">[</span><span class="s1">&#39;flow_id&#39;</span><span class="p">])))</span>
    
    <span class="k">return</span> <span class="n">demand_data</span></div>

<div class="viewcode-block" id="drop_random_flow_from_demand_data"><a class="viewcode-back" href="../../../../trafpy.generator.src.html#trafpy.generator.src.flowcentric.drop_random_flow_from_demand_data">[docs]</a><span class="k">def</span> <span class="nf">drop_random_flow_from_demand_data</span><span class="p">(</span><span class="n">demand_data</span><span class="p">):</span>
    <span class="n">event_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">demand_data</span><span class="p">[</span><span class="s1">&#39;event_time&#39;</span><span class="p">]))]</span>
    <span class="n">flow_idx_to_drop</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">event_indices</span><span class="p">)</span>
    
    <span class="n">num_loops</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">demand_data</span><span class="p">[</span><span class="s1">&#39;flow_size&#39;</span><span class="p">][</span><span class="n">flow_idx_to_drop</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">demand_data</span><span class="p">[</span><span class="s1">&#39;flow_size&#39;</span><span class="p">][</span><span class="n">flow_idx_to_drop</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">flow_idx_to_drop</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">flow_idx_to_drop</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">event_indices</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="c1"># start from beginning</span>
            <span class="n">flow_idx_to_drop</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">num_loops</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">num_loops</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">event_indices</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Cannot find event in demand_data to drop.&#39;</span><span class="p">)</span>
            
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">demand_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>        
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">demand_data</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">new_data</span> <span class="o">=</span> <span class="n">demand_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">new_data</span><span class="p">[</span><span class="n">flow_idx_to_drop</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># is numpy array</span>
            <span class="n">new_data</span> <span class="o">=</span> <span class="n">demand_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="n">new_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">new_data</span><span class="p">,</span> <span class="n">flow_idx_to_drop</span><span class="p">)</span>
        <span class="n">demand_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_data</span>
            
    <span class="k">return</span> <span class="n">demand_data</span></div>

<div class="viewcode-block" id="get_flow_centric_demand_data_load_rate"><a class="viewcode-back" href="../../../../trafpy.generator.src.html#trafpy.generator.src.flowcentric.get_flow_centric_demand_data_load_rate">[docs]</a><span class="k">def</span> <span class="nf">get_flow_centric_demand_data_load_rate</span><span class="p">(</span><span class="n">demand_data</span><span class="p">):</span>
    <span class="n">info_arrived</span> <span class="o">=</span> <span class="n">get_flow_centric_demand_data_total_info_arrived</span><span class="p">(</span><span class="n">demand_data</span><span class="p">)</span>
    <span class="n">first_event_time</span><span class="p">,</span> <span class="n">last_event_time</span> <span class="o">=</span> <span class="n">get_first_last_flow_arrival_times</span><span class="p">(</span><span class="n">demand_data</span><span class="p">)</span>
    
    <span class="n">load_rate</span> <span class="o">=</span> <span class="n">info_arrived</span><span class="o">/</span><span class="p">(</span><span class="n">last_event_time</span><span class="o">-</span><span class="n">first_event_time</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">load_rate</span></div>



<div class="viewcode-block" id="get_flow_centric_demand_data_total_info_arrived"><a class="viewcode-back" href="../../../../trafpy.generator.src.html#trafpy.generator.src.flowcentric.get_flow_centric_demand_data_total_info_arrived">[docs]</a><span class="k">def</span> <span class="nf">get_flow_centric_demand_data_total_info_arrived</span><span class="p">(</span><span class="n">demand_data</span><span class="p">):</span> 
    <span class="n">info_arrived</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">flow_size</span> <span class="ow">in</span> <span class="n">demand_data</span><span class="p">[</span><span class="s1">&#39;flow_size&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">flow_size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">info_arrived</span> <span class="o">+=</span> <span class="n">flow_size</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
    
    <span class="k">return</span> <span class="n">info_arrived</span></div>
            
<div class="viewcode-block" id="get_first_last_flow_arrival_times"><a class="viewcode-back" href="../../../../trafpy.generator.src.html#trafpy.generator.src.flowcentric.get_first_last_flow_arrival_times">[docs]</a><span class="k">def</span> <span class="nf">get_first_last_flow_arrival_times</span><span class="p">(</span><span class="n">demand_data</span><span class="p">):</span>
    <span class="n">arrival_times</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">demand_data</span><span class="p">[</span><span class="s1">&#39;event_time&#39;</span><span class="p">])):</span>
        <span class="k">if</span> <span class="n">demand_data</span><span class="p">[</span><span class="s1">&#39;flow_size&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">demand_data</span><span class="p">[</span><span class="s1">&#39;sn&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span> <span class="o">!=</span> <span class="n">demand_data</span><span class="p">[</span><span class="s1">&#39;dn&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">]:</span>
            <span class="n">arrival_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">demand_data</span><span class="p">[</span><span class="s1">&#39;flow_size&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrival_times</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Could not find first event establish request with size &gt; 0.. This occurs because either demand_data given does not contain any events, or because all events have had to be dropped to try get below your specified target load. Try increasing the target load or increasing the granularity of load per demand (by e.g. decreasing demand sizes, increasing total number of demands, etc.) when you generate your demand data so that this function can more easily hit your desired load target.&#39;</span><span class="p">)</span>

    <span class="n">time_first_flow_arrived</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">arrival_times</span><span class="p">)</span>
    <span class="n">time_last_flow_arrived</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">arrival_times</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">time_first_flow_arrived</span><span class="p">,</span> <span class="n">time_last_flow_arrived</span></div>



</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Christopher W. F. Parsonson

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>